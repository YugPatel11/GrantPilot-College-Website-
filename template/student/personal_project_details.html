{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PP Savani University - SSIP</title>
    <link rel="icon" type="image/png" href="{% static 'Images/Logo/PPSU_logo.png' %}">

  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Raleway:wght@700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* General Reset and Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      background: #f4f4f3;
      color: #040405;
      line-height: 1.6;
    }

    /* Header Styles */
    header {
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 2vw;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 999;
      flex-wrap: wrap;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      height: 65px;
      transition: transform 0.2s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    /* Main Content Heading */
    .dashboard-page-heading {
      text-align: center;
      font-size: 2.5rem;
      color: #da1f21;
      font-family: 'Raleway', sans-serif;
      margin-top: 40px;
    }

    /* Section Card and Information Grid */
    .section-card {
      background: #fffffa;
      border-left: 5px solid #da1f21;
      border-radius: 12px;
      padding: 30px;
      margin: 30px auto;
      max-width: 95%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: bold;
      color: #1076b9;
      font-family: 'Raleway', sans-serif;
      margin-bottom: 25px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }

    .info-grid label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      color: #444;
    }

    .info-grid textarea {
      width: 100%;
      min-height: 100px;
      resize: vertical;
      font-size: 1rem;
      padding: 10px 15px;
      font-family: 'Open Sans', sans-serif;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      color: #333;
      line-height: 1.4;
    }

    .info-grid textarea[readonly] {
      background: #f4f4f3;
    }

    .info-grid p {
      margin: 6px 0 15px;
      font-size: 1rem;
      color: #333;
      background: #f9f9f9;
      padding: 10px 14px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .project-photo {
      width: 300px;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
    }

    .simple-info p {
      margin-bottom: 10px;
      font-size: 1rem;
      color: #333;
    }

    /* Utilization Table */
    .utilization-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .utilization-table th,
    .utilization-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    .utilization-table th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    .utilization-table input[type="text"],
    .utilization-table input[type="number"],
    .utilization-table input[type="date"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* Upload Bill Button (Circular +) */
    .upload-bill-btn {
      background-color: #1076b9;
      border: none;
      color: white;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 50%;
    }
    
    /* Action Buttons (New Styles) */
    .action-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap; /* Allows buttons to wrap on smaller screens */
      gap: 20px;
      margin: 50px auto;
      max-width: 95%;
    }

    .btn {
      background-color: #1076b9;
      color: #fff;
      padding: 12px 28px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      text-decoration: none;
      display: inline-flex; /* Use flexbox for icon alignment */
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
      background-color: #0a5a8d;
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .btn i {
      margin-right: 8px;
    }
    
    .btn-success {
      background-color: #28a745; /* Green for success/save actions */
    }

    .btn-success:hover {
      background-color: #218838;
    }

    .btn-info {
      background-color: #17a2b8; /* Blue for view/information actions */
    }

    .btn-info:hover {
      background-color: #138496;
    }

    /* Style for the inline "Save" button in the table form */
    .save-utilization-btn {
      background-color: #1076b9;
      color: #fff;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
    }

    .save-utilization-btn:hover {
      background-color: #0a5a8d;
      transform: translateY(-1px);
    }

    .save-utilization-btn i {
      margin-right: 8px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .logo{
        height: 35px;
        width:auto;
      }
      .info-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-page-heading {
        font-size: 2rem;
      }

      .section-card {
        padding: 20px;
      }
    }
  </style>
</head>

<body>

  <header>
    <div class="header-left">
      <img class="logo" src="{% static 'Images/Logo/ppsu.png' %}" alt="P P Savani University Logo">
      <img class="logo" src="{% static 'Images/Logo/1.png' %}" alt="University Logo">
      <img class="logo" src="{% static 'Images/Logo/ebc.png' %}" alt="EBC Logo">
      <img class="logo" src="{% static 'Images/Logo/ssip.png' %}" alt="SSIP Logo">
    </div>
  </header>

  <main>
    <h1 class="dashboard-page-heading">
      {% if project %}
      {{ project.title }}
      {% else %}
      {{ application.project_title }}
      {% endif %}
    </h1>

    <div class="section-card">
      <div class="section-title">üìÅ Project Information</div>
      <div class="info-grid">
        <div><label>Broad Area</label><textarea
            readonly>{% if project and project.broad_area %}{{ project.broad_area }}{% elif application and application.broad_area %}{{ application.broad_area }}{% else %}N/A{% endif %}</textarea>
        </div>
        <div><label>Startup Name</label><textarea
            readonly>{% if project %}{{ project.startup_name|default:"N/A" }}{% else %}{{ application.startup_name|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Driving Question</label><textarea
            readonly>{% if project %}{{ project.driving_question|default:"N/A" }}{% else %}{{ application.driving_question|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Major Problems</label><textarea
            readonly>{% if project %}{{ project.major_problems|default:"N/A" }}{% else %}{{ application.major_problems|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Existing Alternatives</label><textarea
            readonly>{% if project %}{{ project.existing_alternatives|default:"N/A" }}{% else %}{{ application.existing_alternatives|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Proposed Solution</label><textarea
            readonly>{% if project %}{{ project.proposed_solution|default:"N/A" }}{% else %}{{ application.proposed_solution|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Unique Value Proposition</label><textarea
            readonly>{% if project %}{{ project.unique_value_proposition|default:"N/A" }}{% else %}{{ application.unique_value_proposition|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Early Adopters</label><textarea
            readonly>{% if project %}{{ project.early_adopters|default:"N/A" }}{% else %}{{ application.early_adopters|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Sustainability Plan</label><textarea
            readonly>{% if project %}{{ project.sustainability_plan|default:"N/A" }}{% else %}{{ application.sustainability_plan|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>Timeline</label><textarea
            readonly>{% if project %}{{ project.timeline|default:"N/A" }}{% else %}{{ application.timeline|default:"N/A" }}{% endif %}</textarea>
        </div>
        <div><label>IPR Potential</label><textarea
            readonly>{% if project %}{{ project.ipr_potential|yesno:"Yes,No" }}{% else %}{{ application.ipr_potential|yesno:"Yes,No" }}{% endif %}</textarea>
        </div>
      </div>
    </div>

 <div class="section-card">
  <div class="section-title">üì∏ Project Photos</div>
  <div class="info-grid">
    
    <!-- Group Photo -->
    <div>
      <label>Group Photo</label>
      {% if project.group_photo %}
      <img src="{{ project.group_photo.url }}" alt="Group Photo" class="project-photo">
      {% else %}
      <p>N/A</p>
      {% endif %}

      <!-- Form to upload/change group photo -->
      <form method="post" action="{% url 'update_group_photo' project.id %}" enctype="multipart/form-data" style="margin-top: 10px;">
        {% csrf_token %}
        <input type="file" name="group_photo" accept="image/*" required>
        <button type="submit" class="btn btn-info" style="margin-top: 8px;">
          <i class="fas fa-upload"></i> Change Group Photo
        </button>
      </form>
    </div>

    <!-- Product Photo -->
    <div>
      <label>Product Photo</label>
      {% if project.product_photo %}
      <img src="{{ project.product_photo.url }}" alt="Product Photo" class="project-photo">
      {% else %}
      <p>N/A</p>
      {% endif %}

      <!-- Form to upload/change product photo -->
      <form method="post" action="{% url 'update_product_photo' project.id %}" enctype="multipart/form-data" style="margin-top: 10px;">
        {% csrf_token %}
        <input type="file" name="product_photo" accept="image/*" required>
        <button type="submit" class="btn btn-info" style="margin-top: 8px;">
          <i class="fas fa-upload"></i> Change Product Photo
        </button>
      </form>
    </div>

  </div>
</div>


    {% if application %}
    <div class="section-card">
      <div class="section-title">üë®‚Äçüíº Team Leader Details</div>
      <div class="info-grid">
        <div><label>Name</label>
          <p>{{ application.team_leader.name }}</p>
        </div>
        <div><label>Email</label>
          <p>{{ application.team_leader.email }}</p>
        </div>
        <div><label>Enrollment ID</label>
          <p>{{ application.team_leader.enrollment_id }}</p>
        </div>
        <div><label>Semester</label>
          <p>{{ application.team_leader.semester }}</p>
        </div>
        <div><label>Phone</label>
          <p>{{ application.team_leader.phone }}</p>
        </div>
        <div><label>School</label>
          <p>{{ application.team_leader.school }}</p>
        </div>
        <div><label>Department</label>
          <p>{{ application.team_leader.department }}</p>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-title">üéì Mentor Details</div>
      <div class="info-grid">
        <div><label>Name</label>
          <p>{{ application.mentor.name }}</p>
        </div>
        <div><label>Email</label>
          <p>{{ application.mentor.email }}</p>
        </div>
        <div><label>Phone</label>
          <p>{{ application.mentor.phone }}</p>
        </div>
        <div><label>School</label>
          <p>{{ application.mentor.school }}</p>
        </div>
      </div>
    </div>

    {% if application.co_mentor %}
    <div class="section-card">
      <div class="section-title">üéì Co-Mentor Details</div>
      <div class="info-grid">
        <div><label>Name</label>
          <p>{{ application.co_mentor.name }}</p>
        </div>
        <div><label>Email</label>
          <p>{{ application.co_mentor.email }}</p>
        </div>
      </div>
    </div>
    {% endif %}

    {% for member in application.members.all %}
    <div class="section-card">
      <div class="section-title">üë• Member {{ forloop.counter }}</div>
      <div class="info-grid">
        <div><label>Name</label>
          <p>{{ member.name }}</p>
        </div>
        <div><label>Email</label>
          <p>{{ member.email }}</p>
        </div>
        <div><label>Enrollment ID</label>
          <p>{{ member.enrollment_id }}</p>
        </div>
        <div><label>Semester</label>
          <p>{{ member.semester }}</p>
        </div>
        <div><label>Phone</label>
          <p>{{ member.phone }}</p>
        </div>
        <div><label>School</label>
          <p>{{ member.school }}</p>
        </div>
        <div><label>Department</label>
          <p>{{ member.department }}</p>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="section-card">
      <p>No team members listed.</p>
    </div>
    {% endfor %}
    {% endif %}

    {% if project %}
    <div class="section-card">
      <div class="section-title">üíµ Grant Information</div>
      <div class="simple-info">
        <p><strong>Has Received Grant:</strong> {{ project.has_received_grant|yesno:"Yes,No" }}</p>
        {% if project.has_received_grant %}
        <p><strong>Approved Grant Amount:</strong> ‚Çπ{{ project.approved_grant_amount }}</p>
        {% endif %}
      </div>
    </div>

    <div class="section-card">
  <div class="section-title">üìù Utilization Certificates</div>
  <div class="simple-info">

    {% if project.utilization_certificates.all %}
    <div>
      <h4 style="color: #1076b9; margin-bottom: 12px;">üìÑ Uploaded Certificates</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
        {% for cert in project.utilization_certificates.all %}
        <div style="background: #f9f9f9; border: 1px solid #ddd; padding: 16px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);">
          <p style="font-weight: 600; margin-bottom: 6px;">Utilization {{ forloop.counter }}</p>
          <p style="font-size: 0.9rem; color: #555;">Uploaded on: {{ cert.uploaded_at|date:"M d, Y" }}</p>
          {% if cert.description %}
          <p style="font-size: 0.9rem; margin-top: 10px;"><strong>Description:</strong> {{ cert.description }}</p>
          {% endif %}
          <a href="{{ cert.certificate_image.url }}" target="_blank"
            style="display: inline-block; margin-top: 12px; background-color: #17a2b8; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">
            <i class="fas fa-eye"></i> View Utilization
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if project.has_received_grant %}
    <h4 style="margin-top: 30px; color: #1076b9;">‚ûï Add New Utilization Details</h4>
    <form method="post" action="{% url 'your_new_utilization_view_url' project.id %}" enctype="multipart/form-data">
      {% csrf_token %}
      <table class="utilization-table">
        <thead>
          <tr>
            <th>Sr No</th>
            <th>Item</th>
            <th>Date</th>
            <th>Amount in RS</th>
            <th>Bill of utilization</th>
          </tr>
        </thead>
        <tbody>
          {% for record in project.utilization_records.all %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ record.item }}</td>
            <td>{{ record.date }}</td>
            <td>{{ record.amount }}</td>
            <td>
              {% if record.bill_of_utilization %}
              <a href="{{ record.bill_of_utilization.url }}" target="_blank">View Bill</a>
              {% else %}
              N/A
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5">No utilization records found.</td>
          </tr>
          {% endfor %}

          <tr>
            <td></td>
            <td>
              <input type="text" name="item" placeholder="Enter item name" required style="width: 100%;">
            </td>
            <td>
              <input type="date" name="date" required style="width: 100%;">
            </td>
            <td>
              <input type="number" name="amount" placeholder="Amount" required style="width: 100%;">
            </td>
            <td>
              <button type="button" class="upload-bill-btn"
                onclick="document.getElementById('bill_input').click()">+</button>
              <input type="file" name="bill_of_utilization" id="bill_input" style="display: none;" required>
            </td>
          </tr>
        </tbody>
      </table>
      <div style="text-align: right; margin-top: 15px;">
        <button type="submit" class="save-utilization-btn">
          <i class="fas fa-save"></i> Save Utilization
        </button>
      </div>
    </form>
    {% endif %}
  </div>
</div>


    {% endif %}

    <div class="action-buttons">
  <button class="btn" onclick="window.history.back()">‚Üê Back</button>
  {% if project and project.has_received_grant %}
  <a href="{% url 'upload_utilization_certificate' project.id %}" class="btn btn-success">
    <i class="fas fa-upload"></i> Upload Utilization Certificate
  </a>
 
  {% endif %}
</div>

  </main>

</body>

</html>